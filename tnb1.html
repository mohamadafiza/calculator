<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator Audit Elektrik Rumah</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;max-width:420px;margin:auto;padding:12px;background:#f4f6f9}
h2{text-align:center;font-size:20px;margin-bottom:6px}
small{display:block;text-align:center;color:#555;margin-bottom:12px}
label{display:block;margin-top:12px;font-weight:600}
select,input,button{width:100%;padding:10px;margin-top:6px;border-radius:10px;border:1px solid #ccc;font-size:15px}
.mode-box{display:flex;gap:8px;margin-top:8px}
.mode-box label{flex:1}
.mode-box span{display:block;text-align:center;background:#e0e0e0;padding:8px;border-radius:12px;font-weight:600;font-size:14px}
.mode-box input{display:none}
.mode-box input:checked+span{background:#2e7d32;color:#fff}
.card{margin-top:14px;padding:12px;background:#fff;border-radius:14px;box-shadow:0 2px 6px rgba(0,0,0,.1);font-size:14px}
.item{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
.item button{width:auto;padding:4px 8px;font-size:12px;margin-left:4px}
.bar{height:10px;background:#e0e0e0;border-radius:6px;overflow:hidden;margin-top:4px}
.bar div{height:100%;background:#2e7d32}
.warn{background:#fff3cd;border:1px solid #ffeeba;color:#856404}
</style>
</head>
<body>
<h2>Kalkulator Audit Elektrik Rumah</h2>
<small>Fokus punca bil tinggi • Bukan calculator manis</small>

<label>Tambah Peralatan</label>
<select id="appliance">
<option value="">-- pilih peralatan --</option>
<optgroup label="Lampu">
<option value="9">LED Bulb (9W)</option>
<option value="18">LED Tube 2 kaki (18W)</option>
<option value="24">LED Tube 4 kaki (24W)</option>
</optgroup>
<optgroup label="Elektronik Kecil">
<option value="10">Charger Telefon (10W)</option>
<option value="60">TV LED (60W)</option>
<option value="100">Laptop (100W)</option>
<option value="400">Desktop PC (400W)</option>
</optgroup>
<optgroup label="24 Jam / Standby">
<option value="15">Router WiFi (15W)</option>
<option value="120">Penapis Air (120W)</option>
<option value="30">CCTV (30W)</option>
</optgroup>
<optgroup label="Peralatan Rumah">
<option value="80">Kipas Siling (80W)</option>
<option value="300">Peti Sejuk (300W)</option>
<option value="700">Aircond 1HP (700W)</option>
<option value="2000">Kettle Elektrik (2000W)</option>
<option value="3500">Water Heater (3500W)</option>
<option value="2000">Air Fryer (2000W)</option>
<option value="2200">Seterika (2200W)</option>
<option value="500">Mesin Basuh (500W)</option>
</optgroup>
</select>

<label>Watt</label>
<input type="number" id="watt">

<label>Jam sehari <small style="font-weight:400">(contoh: 0.5 = 30 min, 0.17 ≈ 10 min)</small></label>
<input type="number" id="hours" step="0.01">

<label>Hari sebulan</label>
<input type="number" id="days" value="30">

<label>Mode kiraan</label>
<div class="mode-box">
<label><input type="radio" name="mode" value="1" checked><span>Average</span></label>
<label><input type="radio" name="mode" value="1.3"><span>Realistik</span></label>
<label><input type="radio" name="mode" value="1.6"><span>Worst</span></label>
</div>

<label>Kadar elektrik (RM/kWh)</label>
<input type="number" id="rate" value="0.2703" step="0.0001">

<label>Anggaran bil rumah sebulan (RM)</label>
<input type="number" id="totalBill" value="150">

<button onclick="addItem()" style="background:#2e7d32;color:#fff;border:none">Tambah Peralatan</button>
<button onclick="copySummary()" style="margin-top:6px">Copy Ringkasan</button>
<button onclick="exportJSON()" style="margin-top:6px">Export Data</button>

<div id="warning" class="card warn" style="display:none"></div>
<div id="list" class="card"></div>
<div id="output" class="card"></div>

<script>
let items=[];

const applianceSelect = document.getElementById('appliance');
const wattInput = document.getElementById('watt');

applianceSelect.addEventListener('change',()=>{
  if(applianceSelect.value) {
    wattInput.value = applianceSelect.value;
  }
});

function addItem(){
  let w=+wattInput.value,h=+hours.value,d=+days.value;
  let r=+rate.value;
  let m=+document.querySelector('input[name="mode"]:checked').value;
  if(!w||!h) return alert('Isi watt & jam');
  let kwh=(w/1000)*h*d*m;
  let cost=kwh*r;
  items.push({name: applianceSelect.options[applianceSelect.selectedIndex].text, w, h, kwh, cost});
  render();
}

function removeItem(i){items.splice(i,1);render()}

function render(){
  let totalKwh=0,totalCost=0;
  list.innerHTML='<b>Senarai Peralatan</b><br>';
  items.forEach((it,i)=>{
    totalKwh+=it.kwh; totalCost+=it.cost;
    let pct=(it.cost/+totalBill.value)*100;
    list.innerHTML+=`<div class='item'>${it.name} = RM ${it.cost.toFixed(2)} <div><button onclick='removeItem(${i})'>❌</button></div></div><div class='bar'><div style='width:${Math.min(pct,100)}%'></div></div>`;
  });
  let percent=(totalCost/+totalBill.value)*100;
  output.innerHTML=`Jumlah penggunaan: ${totalKwh.toFixed(1)} kWh<br>Jumlah kos: RM ${totalCost.toFixed(2)}<br><b>Sumbangan dari bil rumah: ${percent.toFixed(1)}%</b>`;

  warning.style.display='none';
  if(totalKwh>600){
    warning.style.display='block';
    warning.innerHTML='⚠️ Anggaran melebihi 600 kWh. Retail charge & SST mungkin dikenakan.';
  }
}

function copySummary(){
  if(items.length===0) return alert('Tiada peralatan dalam senarai');
  let text='Ringkasan Audit Elektrik:\n';
  items.forEach((it,i)=>{
    text+=`${i+1}. ${it.name} × ${it.h} jam = RM ${it.cost.toFixed(2)}\n`;
  });
  text+=`\n${output.innerText}`;
  navigator.clipboard.writeText(text).then(()=>alert('Semua detail disalin ke clipboard'));
}

function exportJSON(){
  let data={items,rate:rate.value,totalBill:totalBill.value};
  let blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  let a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='audit-elektrik.json';
  a.click();
}

rate.addEventListener('input',render);
totalBill.addEventListener('input',render);
</script>
</body>
</html>
